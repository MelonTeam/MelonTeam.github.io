---
layout: post
title: "ios开发：静态库与动态库&.a与.framework区别"
date: 2017-11-30 22:16:00 +0800
categories: ios
author: rucasli
tags: 静态库/动态库 iOS framework 静态库
---

* content
{:toc}



##### 前言：

> 最近接手互联SDK的工作，期间不断接触静态库，动态库，.a，.framework，.dylib，这里做一个记录和比较他们之间的异同
<!--more-->

##### 什么是库：

库是共享程序代码的方式，一般分为静态库和动态库。

##### 静态库与动态库的区别

  * 静态库：链接时完整地拷贝至可执行文件中，被多次使用就有多份冗余拷贝。
  * 动态库：链接时不复制，程序运行时由系统动态加载到内存，供程序调用，系统只加载一次，多个程序共用，节省内存。

##### iOS里面静态库与动态库的形式

  * 静态库：.a和.framework两种形式
  * 动态库：.dylib和.framework两种

这里需要注意的是：系统的.framework是动态库，我们自己建立的.framework是静态库。

##### .a与.framework的区别

  * .a是一个纯二进制文件，.framework中除了有二进制文件之外还有资源文件。.a文件不能直接使用，至少要有.h文件配合，
  * .framework文件可以直接使用。

所以可以这样理解：.a + .h + sourceFile = .framework。这里建议使用.framework。

##### 为什么要使用静态库

    
    
    1.方便共享代码，便于合理使用。
    2.实现iOS程序的模块化。可以把固定的业务模块化成静态库。
    3.和别人分享你的代码库，但不想让别人看到你代码的实现。
    4.开发第三方sdk的需要。
    

##### 制作静态库时的几点注意

  1. 注意理解：无论是.a静态库还.framework静态库，我们需要的都是二进制文件+.h+其它资源文件的形式，不同的是，.a本身就是二进制文件，需要我们自己配上.h和其它文件才能使用，而.framework本身已经包含了.h和其它文件，可以直接使用。

  2. 图片资源的处理：两种静态库，一般都是把图片文件单独的放在一个.bundle文件中，一般.bundle的名字和.a或.framework的名字相同。.bundle文件很好弄，新建一个文件夹，把它改名为.bundle就可以了，右键，显示包内容可以向其中添加图片资源。

  3. category是我们实际开发项目中经常用到的，把category打成静态库是没有问题的，但是在用这个静态库的工程中，调用category中的方法时会有找不到该方法的运行时错误（selector not recognized），解决办法是：在使用静态库的工程中配置other linker flags的值为-ObjC。

  1. 如果一个静态库很复杂，需要暴露的.h比较多的话，就可以在静态库的内部创建一个.h文件（一般这个.h文件的名字和静态库的名字相同），然后把所有需要暴露出来的.h文件都集中放在这个.h文件中，而那些原本需要暴露的.h都不需要再暴露了，只需要把.h暴露出来就可以了。

##### 其他

  1. 关注framework对安装包的增量影响，这里可以关注二进制包的优化或编译选项优化
  2. 对二进制文件的分析推荐MachOView

