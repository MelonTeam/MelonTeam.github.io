<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>React Native学习笔记</title>
    <meta name="keywords" content="Android, iOS, 深度学习, 人工智能">
    <meta name="description" content="原理一．React">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://MelonTeam.com/posts/react_native_xue_xi_bi_ji/">
    <link rel="alternate" type="application/rss+xml" title="MelonTeam" href="http://MelonTeam.com/feed.xml ">

    <!-- some other meta -->
    
    <!-- some other stuff like link or script -->
    


</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">MelonTeam</a>
        <small>移动终端前沿技术的探索者</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>首页
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/project/">
                        
                            <i class="fa fa-folder-open"></i>开源项目
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/class/">
                        
                            <i class="fa fa-book"></i>公开课
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>分类
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/board/">
                        
                            <i class="fa fa-pencil"></i>留言板
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>React Native学习笔记</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2017-07-31
            </div>
            
            <div class="label-card">
                <i class="fa fa-user"></i>doreencao
            </div>
            
            
            
            <div class="label-card">
            




<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#ios" title="Category: ios" rel="category">ios</a>
    
  

  <!-- <span class="point">•</span> -->
</span>



            </div>
            
            
            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#iOS" title="Tag: iOS" rel="tag">iOS</a-->
        <a href="/tag/#iOS" title="Tag: iOS" rel="tag">iOS</a>
    
  

</span>



            </div>
            

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        
<p><strong>原理</strong></p>

<p>一．React
<!--more--></p>

<p>以我对前端非常简陋的理解，它需要三个模块实现基本的完整功能：</p>

<p>1.         HTML，创建DOM节点和DOM树，组成页面的结构和基本布局</p>

<p>2.         CSS，影响DOM样式，如位置信息、大小、层级、显示隐藏等</p>

<p>3.         JS，代码中与DOM树节点id一一对应来处理逻辑，以动态操控DOM</p>

<p>React框架提供了一种“简洁的语法高效绘制DOM框架”，即JSX。个人理解的“简洁”是指实现JS与HTML的混合编程，看起来像是在JS中用HTML语言创建DOM节点，开发过程只需要关心如果用JS构造页面。高效性得益于Virtual
DOM机制，DOM需要更新时，创建一个虚拟树即Virtual Dom代表所需状态，将其与之前的Virtual
Dom通过Diff算法进行比对，只渲染被改变的内容，避免了JS引擎判断调用负责渲染的DOM操作接口，充分利用JS引擎的性能高效改动DOM。</p>

<p>二．React Native</p>

<p>移动平台提供了运行JS代码的引擎，而JS可以实现动态配置并表达逻辑信息，二者的结合可以概括React
Native所要解决的问题：基于JS，具备动态配置能力的移动端开发框架，开发者用同一套语法、工具，开发面向安卓、iOS、前端不同平台的应用。</p>

<p>以iOS平台为例，系统平台提供的JavaScript Core框架实现OC代码与JS代码的直接交互。React Native用JavaScript
Core作为JS的解析引擎，并自己实现了一套通用与所有JS引擎的机制，可以理解为以JS的形式告诉native该执行什么OC代码。</p>

<p><img src="/image/react_native_xue_xi_bi_ji/490461277b38e87b22c069d8bc5c35b4ed918b10b1f3af9c5cbe5494359ef78a" alt="" /></p>

<p><strong>性能问题</strong></p>

<p>React Native框架具有APP轻量、支持动态更新、跨平台等优势，也存在兼容性和性能问题。</p>

<p>通过阅读React
Native性能相关的文章，总结出性能问题主要分为两大类：页面初次加载速度慢，大数据量时Listview加载卡顿。下面针对这两大类问题，具体讨论他们的原因和解决方法。</p>

<p><img src="/image/react_native_xue_xi_bi_ji/d0a70f3077d8719288fd6c539ee13d24fb74a097ac7fc54315e059d43325affa" alt="" /></p>

<p>一．页面初次加载速度慢</p>

<p><img src="/image/react_native_xue_xi_bi_ji/e6ead6c5a0949676181e989730e56134419cc2a7dfbaaa537a81e51422af74eb" alt="" /></p>

<p>由上图可知，RN页面初次加载的主要时间消耗在JS Init +Requir上，这主要就是JS Bundle加载的时间。</p>

<p>(一）JS Bundle分包</p>

<p><img src="/image/react_native_xue_xi_bi_ji/912e989111ca2b79b2d0c457bc3a46e874228db75370ab00c6ccfd58a631433e" alt="" /></p>

<p>如上图所示，RN官方的打包工具，会在每一个业务的JS
Bundle中，打包进框架JS代码和业务JS代码，而这个框架JS代码大约有530KB。所以，我们应该改造RN的打包工具，拆分开业务JS和框架JS，每个业务的JS
Bundle只拥有自己的业务JS，然后共用同一份框架JS代码。这样既可以有效减小JS Bundle包，减少加载JS
Bundle的时间，也有利于后续的预加载和缓存。</p>

<p>(二）预加载RN框架</p>

<p>在打开RN界面时，会先加载RN框架，然后在框架上运行业务JS，所以导致整个RN界面打开需要将近1s的时间。</p>

<p>因为前面已经将框架JS和业务JS分离，所以可以在后台预加载一个RN环境，把框架JS代码先跑起来，然后在RN界面真正打开的时候，再跑业务JS，直接进行业务界面的渲染，加快界面打开速度。</p>

<p>二．大数据量时Listview加载卡顿</p>

<p>（一）Listview节点复用</p>

<p>分析卡顿原因，可以从Listview的实现原理入手。React列表的每一项都会带有一个key属性，在React进行虚拟dom
diff时，作为每个列表项的标记。</p>

<p><img src="/image/react_native_xue_xi_bi_ji/f904b524c89bb254dfa1d607772a68fca0761351a9e3065661fe831457f973fb" alt="" /></p>

<p>由上图可知，列表在滑动的过程中，节点并没有复用，react会认为是key1被销毁和key6被创建，这会引发页面重绘，消耗大量的渲染时间。除此之外，被滑出视野范围外的节点，只是从列表这个父节点上移除，但是节点的引用依然存在，还是会占用内存。</p>

<p>所以，节点没有复用，滑动时会触发多次重绘，导致卡顿。同时，由于滑出视野范围的节点没有被及时回收，在大数据量时，会导致内存占用迅速增大，导致整个app卡顿。</p>

<p><img src="/image/react_native_xue_xi_bi_ji/80d46afeae3d8c505e6c084b41987f38673399699332bb820f842ff310c9cac7" alt="" /></p>

<p>通过修改，复用节点，react就会认为仅仅是key1更改了位置，只会引发重排，减少渲染时间。这里的具体方案可以参考native端Recycle
view的实现。</p>

<p>（二）Listview异步加载数据</p>

<p>Listview是同步加载数据的，当数据量大时，容易卡顿。可以考虑异步地往Listview push数据。</p>

<p>（三）ReactNative FlatList</p>

<p>RN新版本中推出的List，其实就是官方实现的复用列表节点的List，性能显著提升。</p>

<p>参考文档：</p>

<p><a href="http://www.jianshu.com/p/978c4bd3a759">React Native
从入门到原理</a><a href="http://www.jianshu.com/p/978c4bd3a759" title="React Native 从入门到原理"></a></p>

<p><a href="https://zhuanlan.zhihu.com/p/23715716">携程是如何做React Native优化的</a></p>

<p><a href="http://geek.csdn.net/news/detail/139051">Qunar React Native 大规模应用实践</a></p>


        </article>
        <hr>

        
        
            
            
                
                    
                        
                        <h2 id="similar_posts">相关文章</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/posts/duo_duan_pai_ban_za_tan/">多端排版杂谈
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/posts/ios_tui_song_diao_shi_gong_ju_easy_apns_provider_de_shi_yong/">iOS推送调试工具Easy APNs Provider的使用
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/posts/ios_kong_jian_dong_hua_de_yi_zhong_tong_yong_fang_fa/">IOS控件动画的一种通用方法
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/posts/feng_zhuang_nei_qian_uicollectionview_he_uipagecontrol_de_scrollview/">封装内嵌UICollectionView和UIPageControl的ScrollView
                            
                            </a>
                        </li>
                        
                        
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/posts/ios_opengl_es_2_0_zhi_chu_ti_yan/">[iOS] OpenGL ES 2.0之初体验
                            
                            </a>
                        </li>
                        
                        
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/posts/opengl_es_ios__xue_xi_bi_ji___ji_chu_pian__yi_/">OpenGL ES (iOS) 学习笔记 — 基础篇（一）
                            
                            </a>
                        </li>
                        
                        
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/posts/shen_du_xue_xi_zhi_feng_ge_qian_yi_jian_jie/">深度学习之风格迁移简介</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/posts/vc_jian_fu_ruo_gan_ji_qiao__yi_/">VC减负若干技巧（一）</a></p>
        
    </div>
</div>


        <h2 id="comments">说一说</h2>
        

<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript">
var uyan_config = {
     'url':'http://MelonTeam.com/posts/react_native_xue_xi_bi_ji/',
     'du':'http://MelonTeam.com', 
     'su':'http://MelonTeam.com/posts/react_native_xue_xi_bi_ji/' 
};
</script>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2136610"></script>
<!-- UY END -->






    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    目录
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">相关文章</a></li>
                    
                    <li><a href="#comments">说一说</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="power">
            <span>
                Copyright © 2017 <a href="https://github.com/MelonTeam" title="GitHub">MelonTeam <i class="fa fa-github" aria-hidden="true"></i></a>. All Rights Reserved.
            </span>
        </p>
    </div>
</footer>


<script type="text/javascript" src="http://tajs.qq.com/stats?sId=62569168" charset="UTF-8"></script>



    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
  </body>

</html>
